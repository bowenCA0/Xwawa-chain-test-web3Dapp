"use strict";var web3,lotteryContract,userAccount,isConnected=!1,drawTimes=1,drawCost=1e4,isSpinning=!1,prizes=[{id:1,name:"ä¸€ç­‰å¥–",probability:.01,color:"#FF6B6B",className:"first-prize"},{id:2,name:"äºŒç­‰å¥–",probability:.05,color:"#4ECDC4",className:"second-prize"},{id:3,name:"ä¸‰ç­‰å¥–",probability:.1,color:"#FFD166",className:"third-prize"},{id:4,name:"å¥–æ± åˆ†çº¢",probability:.15,color:"#06D6A0",className:"pool-prize"},{id:5,name:"åŒå€æŠ½å¥–",probability:.2,color:"#118AB2",className:"double"},{id:6,name:"è°¢è°¢å‚ä¸",probability:.49,color:"#073B4C",className:"nothing"}],lotteryABI=[{inputs:[],name:"draw",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"drawCost",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"}],lotteryContractAddress="0x1234567890123456789012345678901234567890",xwawaTokenAddress="0x0987654321098765432109876543210987654321";function initLanguageSwitch(){var e=document.getElementById("language-switch");if(e){e.addEventListener("change",function(){var e=this.checked?"en":"zh";switchLanguage(e),localStorage.setItem("preferred-language",e)});var t=localStorage.getItem("preferred-language")||"zh";e.checked="en"===t,switchLanguage(t)}}function switchLanguage(t){document.querySelectorAll("[data-lang-zh], [data-lang-en]").forEach(function(e){"zh"===t?e.hasAttribute("data-lang-zh")&&(e.textContent=e.getAttribute("data-lang-zh")):e.hasAttribute("data-lang-en")&&(e.textContent=e.getAttribute("data-lang-en"))})}function checkWalletConnection(){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(window.ethereum)return e.prev=1,e.next=4,regeneratorRuntime.awrap(window.ethereum.request({method:"eth_accounts"}));e.next=18;break;case 4:if(0<(t=e.sent).length)return userAccount=t[0],web3=new Web3(window.ethereum),lotteryContract=new web3.eth.Contract(lotteryABI,lotteryContractAddress),isConnected=!0,updateUI(),e.next=13,regeneratorRuntime.awrap(updateDrawCostFromContract());e.next=13;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(1),console.error("æ£€æŸ¥é’±åŒ…è¿æ¥å¤±è´¥:",e.t0);case 18:case"end":return e.stop()}},null,null,[[1,15]])}function connectWallet(){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,window.ethereum)return console.log("Web3é’±åŒ…å·²æ£€æµ‹åˆ°"),e.next=5,regeneratorRuntime.awrap(window.ethereum.request({method:"eth_requestAccounts"}));e.next=18;break;case 5:return t=e.sent,userAccount=t[0],web3=new Web3(window.ethereum),lotteryContract=new web3.eth.Contract(lotteryABI,lotteryContractAddress),e.next=11,regeneratorRuntime.awrap(updateDrawCostFromContract());case 11:window.ethereum.on("accountsChanged",handleAccountsChanged),window.ethereum.on("chainChanged",handleChainChanged),isConnected=!0,updateUI(),console.log("é’±åŒ…è¿æ¥æˆåŠŸ:",userAccount),e.next=20;break;case 18:alert("è¯·å®‰è£…MetaMaské’±åŒ…ä»¥ä½¿ç”¨æŠ½å¥–åŠŸèƒ½ï¼"),window.open("https://metamask.io/download/","_blank");case 20:e.next=28;break;case 22:e.prev=22,e.t0=e.catch(0),console.error("è¿æ¥é’±åŒ…å¤±è´¥:",e.t0),4001===e.t0.code?alert("ç”¨æˆ·æ‹’ç»äº†é’±åŒ…è¿æ¥è¯·æ±‚"):-32002===e.t0.code?alert("é’±åŒ…è¿æ¥è¯·æ±‚å·²åœ¨å¤„ç†ä¸­ï¼Œè¯·æ£€æŸ¥MetaMask"):alert("è¿æ¥é’±åŒ…æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·é‡è¯•"),isConnected=!1,updateUI();case 28:case"end":return e.stop()}},null,null,[[0,22]])}function updateDrawCostFromContract(){var t,n,r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(lotteryContract.methods.drawCost().call());case 3:t=e.sent,drawCost=web3.utils.fromWei(t,"ether"),console.log("åˆçº¦æŠ½å¥–æˆæœ¬:",drawCost),(n=document.getElementById("cost-amount"))&&(n.textContent=drawCost),updateTotalCost(),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(0),console.error("è·å–æŠ½å¥–æˆæœ¬å¤±è´¥:",e.t0),(r=document.getElementById("cost-amount"))&&(r.textContent=drawCost);case 16:case"end":return e.stop()}},null,null,[[0,11]])}function handleAccountsChanged(e){0===e.length?(isConnected=!1,userAccount=null,console.log("é’±åŒ…å·²æ–­å¼€è¿æ¥")):(userAccount=e[0],console.log("è´¦æˆ·å·²åˆ‡æ¢:",userAccount)),updateUI()}function handleChainChanged(e){console.log("ç½‘ç»œå·²åˆ‡æ¢:",e),window.location.reload()}function updateDrawTimes(e){var t=document.getElementById("draw-times-input"),n=parseInt(t.value)+e;n<1&&(n=1),100<n&&(n=100),t.value=n,drawTimes=n,updateTotalCost()}function validateDrawTimes(){var e=document.getElementById("draw-times-input"),t=parseInt(e.value);isNaN(t)||t<1?t=1:100<t&&(t=100),e.value=t,drawTimes=t,updateTotalCost()}function updateTotalCost(){var e=drawTimes*drawCost,t=document.getElementById("total-cost-amount");t&&(t.textContent=e)}function startDraw(){var t,n,r,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(isConnected){e.next=3;break}return alert("è¯·å…ˆè¿æ¥é’±åŒ…"),e.abrupt("return");case 3:if(isSpinning)return e.abrupt("return");e.next=5;break;case 5:return isSpinning=!0,(t=document.getElementById("draw-button"))&&(t.disabled=!0,t.textContent="æŠ½å¥–ä¸­..."),e.prev=8,n=drawTimes*drawCost,e.next=12,regeneratorRuntime.awrap(getUserTokenBalance());case 12:if((r=e.sent)<n)return alert("ä½™é¢ä¸è¶³ï¼éœ€è¦ ".concat(n," XWAWAï¼Œå½“å‰ä½™é¢ ").concat(r," XWAWA")),e.abrupt("return");e.next=16;break;case 16:return e.next=18,regeneratorRuntime.awrap(drawFromContract());case 18:a=e.sent,playSpinSound(),0<a.length&&spinWheel(a[0].id),setTimeout(function(){0<a.length&&a[0].id<=4&&addWinEffect(a[0].id),showResultModal(a),addResultsToList(a),resetDrawState()},3e3),e.next=29;break;case 24:e.prev=24,e.t0=e.catch(8),console.error("æŠ½å¥–å¤±è´¥:",e.t0),alert("æŠ½å¥–å¤±è´¥ï¼Œè¯·é‡è¯•"),resetDrawState();case 29:case"end":return e.stop()}},null,null,[[8,24]])}function resetDrawState(){isSpinning=!1;var e=document.getElementById("draw-button");e&&(e.disabled=!1,e.textContent="å¼€å§‹æŠ½å¥–")}function getUserTokenBalance(){var t,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(getXwawaContract());case 3:return t=e.sent,e.next=6,regeneratorRuntime.awrap(t.methods.balanceOf(userAccount).call());case 6:return n=e.sent,e.abrupt("return",parseFloat(web3.utils.fromWei(n,"ether")));case 10:return e.prev=10,e.t0=e.catch(0),console.error("è·å–ç”¨æˆ·ä½™é¢å¤±è´¥:",e.t0),e.abrupt("return",0);case 14:case"end":return e.stop()}},null,null,[[0,10]])}function generateMockResults(){for(var e=[],t=0;t<drawTimes;t++){var n=r();e.push(n),0===t&&a(n.id)}!function(e){var n=document.querySelector(".results-list"),t=document.querySelector(".no-results");t&&(t.style.display="none");e.forEach(function(e){var t=document.createElement("div");t.className="result-item ".concat(e.className),t.innerHTML='\n            <span class="result-name">'.concat(e.name,'</span>\n            <span class="result-value">').concat((new Date).toLocaleTimeString(),"</span>\n        "),n.prepend(t)})}(e),1===drawTimes&&setTimeout(function(){!function(e){var t=document.getElementById("result-modal"),n=document.getElementById("result-title"),r=document.getElementById("result-message"),a=document.getElementById("result-icon");n.textContent="æ­å–œè·å¾—: ".concat(e.name),r.textContent=function(e){switch(e){case 1:return"æ­å–œæ‚¨è·å¾—ä¸€ç­‰å¥–ï¼å¥–åŠ±å·²å‘æ”¾åˆ°æ‚¨çš„è´¦æˆ·ã€‚";case 2:return"æ­å–œæ‚¨è·å¾—äºŒç­‰å¥–ï¼å¥–åŠ±å·²å‘æ”¾åˆ°æ‚¨çš„è´¦æˆ·ã€‚";case 3:return"æ­å–œæ‚¨è·å¾—ä¸‰ç­‰å¥–ï¼å¥–åŠ±å·²å‘æ”¾åˆ°æ‚¨çš„è´¦æˆ·ã€‚";case 4:return"æ‚¨è·å¾—äº†å¥–æ± åˆ†çº¢ï¼å¥–åŠ±å·²å‘æ”¾åˆ°æ‚¨çš„è´¦æˆ·ã€‚";case 5:return"æ‚¨è·å¾—äº†åŒå€æŠ½å¥–æœºä¼šï¼ä¸‹æ¬¡æŠ½å¥–å°†è·å¾—åŒå€å¥–åŠ±ã€‚";case 6:return"è°¢è°¢å‚ä¸ï¼Œä¸‹æ¬¡å†æ¥å†å‰ï¼";default:return"æŠ½å¥–ç»“æœæœªçŸ¥ï¼Œè¯·è”ç³»å®¢æœã€‚"}}(e.id),a.textContent=function(e){switch(e){case 1:return"ğŸ†";case 2:return"ğŸ¥ˆ";case 3:return"ğŸ¥‰";case 4:return"ğŸ’°";case 5:return"ğŸ¯";case 6:return"ğŸ˜Š";default:return"â“"}}(e.id),a.style.color=e.color,t.style.display="block"}(e[0])},5500),console.log("æŠ½å¥–å®Œæˆï¼Œç»“æœ:",e);try{console.error("æŠ½å¥–å¤±è´¥:",error),alert("æŠ½å¥–å¤±è´¥ï¼Œè¯·é‡è¯•"),isSpinning=!1,document.getElementById("draw-button").disabled=!1}catch(e){console.error("æŠ½å¥–å¤±è´¥:",e),alert("æŠ½å¥–å¤±è´¥ï¼Œè¯·é‡è¯•"),isSpinning=!1,document.getElementById("draw-button").disabled=!1}function r(){for(var e=Math.random(),t=0,n=0,r=prizes;n<r.length;n++){var a=r[n];if(e<=(t+=a.probability))return a}return prizes[prizes.length-1]}function a(e){var t=document.querySelector(".wheel-inner"),n=document.querySelector(".lottery-wheel-container"),r=document.querySelector(".wheel-pointer");n.classList.add("spinning"),r.classList.add("pointer-active");var a=360-(60*(e-1)+30)+360*(6+2*Math.random());t.style.transition="transform 4s cubic-bezier(0.25, 0.46, 0.45, 0.94)",t.style.transform="rotate(".concat(a,"deg)"),function(){try{var e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),n=e.createGain();t.connect(n),n.connect(e.destination),t.frequency.setValueAtTime(200,e.currentTime),t.frequency.exponentialRampToValueAtTime(100,e.currentTime+.1),n.gain.setValueAtTime(.1,e.currentTime),n.gain.exponentialRampToValueAtTime(.01,e.currentTime+.1),t.start(e.currentTime),t.stop(e.currentTime+.1)}catch(e){console.log("Audio not supported")}}(),"vibrate"in navigator&&navigator.vibrate([100,50,100]),setTimeout(function(){n.classList.add("mid-spin")},2e3),setTimeout(function(){isSpinning=!1,n.classList.remove("spinning","mid-spin"),r.classList.remove("pointer-active"),n.classList.add("spin-complete"),function(e){var t=document.querySelector(".lottery-wheel-container");e<=3?(t.classList.add("major-win"),function(){for(var t=document.querySelector(".lottery-wheel-container"),e=0;e<20;e++)setTimeout(function(){var e=document.createElement("div");e.className="firework-particle",e.style.left=100*Math.random()+"%",e.style.top=100*Math.random()+"%",t.appendChild(e),setTimeout(function(){e.remove()},1e3)},100*e)}(),setTimeout(function(){t.classList.remove("major-win")},3e3)):e<=5&&(t.classList.add("minor-win"),setTimeout(function(){t.classList.remove("minor-win")},2e3))}(e),document.getElementById("draw-button").disabled=!1,setTimeout(function(){n.classList.remove("spin-complete")},1e3)},4e3)}}function drawFromContract(){var t,n,r,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(getXwawaContract());case 3:return t=e.sent,e.next=6,regeneratorRuntime.awrap(t.methods.balanceOf(userAccount).call());case 6:if(n=e.sent,r=web3.utils.toWei((drawCost*drawTimes).toString(),"ether"),parseInt(n)<parseInt(r))return alert("Xwawaä»£å¸ä½™é¢ä¸è¶³ï¼Œè¯·å……å€¼åå†è¯•"),e.abrupt("return",null);e.next=11;break;case 11:return e.next=13,regeneratorRuntime.awrap(t.methods.approve(lotteryContractAddress,r).send({from:userAccount}));case 13:return e.next=15,regeneratorRuntime.awrap(lotteryContract.methods.draw().send({from:userAccount}));case 15:return a=e.sent,e.abrupt("return",a);case 19:throw e.prev=19,e.t0=e.catch(0),console.error("åˆçº¦æŠ½å¥–å¤±è´¥:",e.t0),e.t0;case 23:case"end":return e.stop()}},null,null,[[0,19]])}function getXwawaContract(){var t,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(lotteryContract.methods.XWAWA_COIN().call());case 3:return t=e.sent,n=[{constant:!0,inputs:[{name:"_owner",type:"address"}],name:"balanceOf",outputs:[{name:"balance",type:"uint256"}],type:"function"},{constant:!1,inputs:[{name:"_spender",type:"address"},{name:"_value",type:"uint256"}],name:"approve",outputs:[{name:"",type:"bool"}],type:"function"}],e.abrupt("return",new web3.eth.Contract(n,t));case 8:throw e.prev=8,e.t0=e.catch(0),console.error("è·å–Xwawaåˆçº¦å¤±è´¥:",e.t0),e.t0;case 12:case"end":return e.stop()}},null,null,[[0,8]])}document.addEventListener("DOMContentLoaded",function(){updateUI(),document.getElementById("connect-wallet-btn").addEventListener("click",connectWallet),document.getElementById("draw-button").addEventListener("click",startDraw),document.getElementById("draw-times-minus").addEventListener("click",function(){return updateDrawTimes(-1)}),document.getElementById("draw-times-plus").addEventListener("click",function(){return updateDrawTimes(1)}),document.getElementById("draw-times-input").addEventListener("change",validateDrawTimes),document.querySelectorAll(".close-modal, .close-result-btn").forEach(function(e){e.addEventListener("click",closeResultModal)}),initLanguageSwitch(),checkWalletConnection()});
//# sourceMappingURL=lottery.min.js.map
